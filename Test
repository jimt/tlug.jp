#!/usr/bin/env bash
set -e -o pipefail
trap 'echo 1>&2 FAILED.; exit 1;' 0

basedir=$(cd "$(dirname "$0")" && pwd -P)
cd "$basedir"

mkdir -p ~/.local/bin/
export PATH=~/.local/bin:$PATH
stack --version \
    || curl -sSL https://get.haskellstack.org/ | sh -s - -d ~/.local/bin

stack upgrade
stack build
stack exec site build 

trap '' 0
