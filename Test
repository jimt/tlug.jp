#!/usr/bin/env bash
set -e -o pipefail

basedir=$(cd "$(dirname "$0")" && pwd -P)
cd "$basedir"

trap 'echo 1>&2 FAILED.; exit 1;' 0

mkdir -p ~/.local/bin/
export PATH=~/.local/bin:$PATH
stack --version \
    || curl -sSL https://get.haskellstack.org/ | sh -s - -d ~/.local/bin

stack upgrade
stack build
stack exec site build 

trap '' 0
